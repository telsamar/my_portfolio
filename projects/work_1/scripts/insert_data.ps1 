$DB_NAME = "university_db"
$DB_USER = "postgres"
$DB_PASSWORD = $env:DB_PASSWORD
$HOST = "localhost"
$PORT = "5432"

$env:PGPASSWORD = $DB_PASSWORD

function Execute-Sql {
    param (
        [string]$SqlCommand,
        [string]$Description
    )

    Write-Host $Description -ForegroundColor Cyan
    $result = psql -h $HOST -p $PORT -U $DB_USER -d $DB_NAME -c $SqlCommand

    if ($LASTEXITCODE -eq 0) {
        Write-Host "$Description успешно выполнено." -ForegroundColor Green
    }
    else {
        Write-Host "Не удалось выполнить: $Description" -ForegroundColor Red
        Write-Host "Ошибка: $result" -ForegroundColor Red
        exit $LASTEXITCODE
    }
}

$studentsSql = @"
INSERT INTO Студенты (имя, фамилия, дата_рождения, email) VALUES
('Иван', 'Иванов', '2000-01-15', 'ivan.ivanov@example.com'),
('Мария', 'Петрова', '1999-05-22', 'maria.petrova@example.com'),
('Сергей', 'Сидоров', '2001-03-10', 'sergey.sidorov@example.com'),
('Анна', 'Кузнецова', '2000-07-30', 'anna.kuznetsova@example.com'),
('Дмитрий', 'Морозов', '1998-11-05', 'dmitry.morozov@example.com');
"@

Execute-Sql -SqlCommand $studentsSql -Description "Наполнение таблицы Студенты"

$subjectsSql = @"
INSERT INTO Предметы (название, описание) VALUES
('Математика', 'Основы математического анализа и алгебры'),
('Физика', 'Изучение законов природы и физических явлений'),
('Программирование', 'Основы разработки программного обеспечения'),
('История', 'Изучение истории человечества'),
('Литература', 'Анализ литературных произведений');
"@

Execute-Sql -SqlCommand $subjectsSql -Description "Наполнение таблицы Предметы"

$teachersSql = @"
INSERT INTO Преподаватели (имя, фамилия, email, должность) VALUES
('Алексей', 'Новиков', 'alexey.novikov@example.com', 'Доцент'),
('Елена', 'Смирнова', 'elena.smirnova@example.com', 'Профессор'),
('Игорь', 'Ковалев', 'igor.kovalev@example.com', 'Ассистент'),
('Ольга', 'Федорова', 'olga.fedorova@example.com', 'Старший преподаватель'),
('Павел', 'Лебедев', 'pavel.lebedev@example.com', 'Доцент');
"@

Execute-Sql -SqlCommand $teachersSql -Description "Наполнение таблицы Преподаватели"

$examsSql = @"
INSERT INTO Экзамены (студент_id, предмет_id, преподаватель_id, оценка, дата_экзамена) VALUES
(1, 1, 1, 85, '2024-06-15'),
(2, 2, 2, 90, '2024-06-16'),
(3, 3, 3, 75, '2024-06-17'),
(4, 4, 4, 88, '2024-06-18'),
(5, 5, 5, 92, '2024-06-19');
"@

Execute-Sql -SqlCommand $examsSql -Description "Наполнение таблицы Экзамены"

if ($LASTEXITCODE -eq 0) {
    Write-Host "Данные успешно добавлены во все таблицы." -ForegroundColor Green
}
else {
    Write-Host "Произошла ошибка при добавлении данных." -ForegroundColor Red
}

Remove-Item Env:\PGPASSWORD -ErrorAction SilentlyContinue
